String.prototype.plural=function(e){var t={"(quiz)$":"$1zes","^(ox)$":"$1en","([m|l])ouse$":"$1ice","(matr|vert|ind)ix|ex$":"$1ices","(x|ch|ss|sh)$":"$1es","([^aeiouy]|qu)y$":"$1ies","(hive)$":"$1s","(?:([^f])fe|([lr])f)$":"$1$2ves","(shea|lea|loa|thie)f$":"$1ves",sis$:"ses","([ti])um$":"$1a","(tomat|potat|ech|her|vet)o$":"$1oes","(bu)s$":"$1ses","(alias)$":"$1es","(octop)us$":"$1i","(ax|test)is$":"$1es","(us)$":"$1es","([^s]+)$":"$1s"},n={"(quiz)zes$":"$1","(matr)ices$":"$1ix","(vert|ind)ices$":"$1ex","^(ox)en$":"$1","(alias)es$":"$1","(octop|vir)i$":"$1us","(cris|ax|test)es$":"$1is","(shoe)s$":"$1","(o)es$":"$1","(bus)es$":"$1","([m|l])ice$":"$1ouse","(x|ch|ss|sh)es$":"$1","(m)ovies$":"$1ovie","(s)eries$":"$1eries","([^aeiouy]|qu)ies$":"$1y","([lr])ves$":"$1f","(tive)s$":"$1","(hive)s$":"$1","(li|wi|kni)ves$":"$1fe","(shea|loa|lea|thie)ves$":"$1f","(^analy)ses$":"$1sis","((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$":"$1$2sis","([ti])a$":"$1um","(n)ews$":"$1ews","(h|bl)ouses$":"$1ouse","(corpse)s$":"$1","(us)es$":"$1",s$:""},i={move:"moves",foot:"feet",goose:"geese",sex:"sexes",child:"children",man:"men",tooth:"teeth",person:"people"},r=["sheep","fish","deer","series","species","money","rice","information","equipment"];if(r.indexOf(this.toLowerCase())>=0)return this;for(word in i){if(e)var a=new RegExp(i[word]+"$","i"),o=word;else var a=new RegExp(word+"$","i"),o=i[word];if(a.test(this))return this.replace(a,o)}if(e)var s=n;else var s=t;for(reg in s){var a=new RegExp(reg,"i");if(a.test(this))return this.replace(a,s[reg])}return this};var wingaru=wingaru||{};wingaru.config=function(){var e="http://s3-ap-southeast-2.amazonaws.com/",t="demos.wingaru.com.au/",n="icon.wingaru.com.au/";return{displayLog:!0,assetsUrl:e+t,apiUrl:"http://dev-api.wingarukids.com.au/",scriptUrl:"",containerId:"wingaru-game",mode:"live",iconUrl:function(t){return e+n+t+".png"},contentUrl:function(n,i){return e+t+n+i},s3Url:function(t,n){return e+t+".wingaru.com.au/"+n}}}(),wingaru.util=function(){function e(){if(wingaru.config.displayLog){var e=Array.prototype.slice.call(arguments);e.map(function(e){console.log("Wingaru Log: ",e)})}}function t(e,t,n){return wingaru.util.isSession?"undefined"!=typeof window.sessionStorage[e]?n===!1?window.sessionStorage[e]:JSON.parse(window.sessionStorage[e]):t:"undefined"!=typeof window.localStorage[e]?n===!1?window.localStorage[e]:JSON.parse(window.localStorage[e]):t}function n(e,t,n){wingaru.util.isSession?window.sessionStorage[e]=n===!1?t:JSON.stringify(t):window.localStorage[e]=n===!1?t:JSON.stringify(t)}function i(e){wingaru.util.isSession?delete window.sessionStorage[e]:delete window.localStorage[e]}function r(){wingaru.util.removeData("wingaru.token")}function a(e){wingaru.util.setData("wingaru.isAuthed","true",!1),wingaru.util.setData("wingaru.token",e,!1)}function o(){return wingaru.util.getData("wingaru.token","",!1)}var s=!!window.sessionStorage;return console.log("Wingaru Integration Session Support",s),{isSession:s,destroyToken:r,setToken:a,getToken:o,getData:t,setData:n,removeData:i,log:e}}(),wingaru.auth=function(){function e(e){var t=$.Deferred();return wingaru.api.request("POST","global/authenticate",e).done(function(e){e.status?(wingaru.util.setToken(e.token),t.resolve(e)):(wingaru.util.log("Authentication Failed"),t.reject(e))}),t.promise()}function t(){return wingaru.util.getData("wingaru.isAuthed",!1)}function n(){var e=$.Deferred();try{wingaru.util.removeData("wingaru.isAuthed"),wingaru.util.removeData("wingaru.token"),wingaru.util.removeData("wingaru.profile"),e.resolve(!0)}catch(t){e.reject(t)}return e.promise()}function i(){var e=$.Deferred();if($profile=wingaru.util.getData("wingaru.profile",!1),0!=$profile)try{e.resolve($profile)}catch(t){e.reject(t)}else wingaru.api.requestWithToken("GET","global/profile").done(function(t){t.status?(wingaru.util.setData("wingaru.profile",t.profile),e.resolve(t.profile)):e.reject(t)});return e.promise()}return{login:e,logout:n,isAuthed:t,getUser:i}}(),wingaru.api=function(){function e(e,t,n){return $.ajax({method:e||"GET",data:n||{},url:wingaru.config.apiUrl+t,dataType:"json"})}function t(e,t,n){return $.ajax({method:e||"GET",data:n||{},url:wingaru.config.apiUrl+t,headers:{"X-Request-Token":wingaru.util.getToken()},dataType:"json"})}function n(e,t){function n(t){return"boolean"==typeof t&&0==t?e:e.plural()}function i(e,t){return wingaru.api.requestWithToken("GET",n(t),e||{})}function r(t){return wingaru.api.requestWithToken("GET",e+"/"+t,{})}function a(t,n){return wingaru.api.requestWithToken(t,e+"/"+n,{})}function o(e,t){return wingaru.api.requestWithToken("POST",n(t),e||{})}function s(t,n){return wingaru.api.requestWithToken("PUT",e+"/"+t,n||{})}function u(t,n){return wingaru.api.requestWithToken("DELETE",e+"/"+t,n||{})}return{all:i,get:r,custom:a,create:o,update:s,remove:u}}return{request:e,requestWithToken:t,createResource:n}}(),wingaru.game={},wingaru.games=function(){function e(e,t){if("object"==typeof e)for(var n in e)d[n]=e[n];else d[e]=t}function t(e,t,n,i){switch(wingaru.game=new Phaser.Game(d.width,d.height,Phaser.AUTO,n||wingaru.config.containerId,d.state,d.transparent,d.antialias,d.physicsConfig),wingaru.config.mode){case"local":wingaru.config.assetsUrl="",wingaru.config.scriptUrl="games/"+e+".js";break;case"live":wingaru.config.assetsUrl="http://s3-ap-southeast-2.amazonaws.com/demos.wingaru.com.au/"+e+"/",wingaru.config.scriptUrl=wingaru.config.assetsUrl+"assets/js/scripts.js"}return""!=wingaru.config.mode&&load.js(wingaru.config.scriptUrl,function(){wingaru.game.state.start(t)}),wingaru.util.setData("wingaru.game.id",e),wingaru.util.setData(e,{gameId:e,startState:t,div:n,transparent:i,phaser:d}),wingaru.game}function n(e){return wingaru.util.getData(e,{})}function i(e,t){y[e]=t}function r(){$args=Array.prototype.slice.call(arguments),$name=$args.shift(),y[$name].apply(this,$args)}function a(e,t){config=wingaru.games.getConfig(e),t.apply(this,[y.init(config)])}function o(e,t,n){n.apply(this,[y.next(e,t)])}function s(e,t){m[e]=value,y.toolbar(e,t)}function u(e){return"undefined"!=typeof e?"undefined"!=typeof m[e]&&m[e]:m}function o(e){$args=Array.prototype.slice.call(arguments),y.next.apply(this,$args)}function c(e){$args=Array.prototype.slice.call(arguments),y.home.apply(this,$args)}function l(e,t){y.change(e,t)}function g(e){$args=Array.prototype.slice.call(arguments),y.started.apply(this,$args)}function f(e){$args=Array.prototype.slice.call(arguments),y.leveled.apply(this,$args)}function p(e){$args=Array.prototype.slice.call(arguments),y.completed.apply(this,$args)}function $(e){$args=Array.prototype.slice.call(arguments),y.flash.apply(this,$args)}function w(e){$args=Array.prototype.slice.call(arguments),y.achieved.apply(this,$args)}function h(e){$args=Array.prototype.slice.call(arguments),y.store.apply(this,$args)}var d={width:800,height:600,state:null,transparent:!1,antialias:!0,physicsConfig:null},m={progress:0,timer:6e4,home:!0,next:!0},y={init:function(){},started:function(){},leveled:function(){},completed:function(){},flash:function(){},achieved:function(){},store:function(){},toolbar:function(){},next:function(){},home:function(){},change:function(){}};return{add:t,setPhaserConfig:e,getConfig:n,setEvent:i,callEvent:r,getToolbar:u,on:{callNext:o,callHome:c,callChange:l,callInitialized:a,callStarted:g,callLeveled:f,callCompleted:p,callFlash:$,callAchieved:w,callStore:h,updateToolbar:s}}}(),wingaru.items=function(){function e(e){u=e,c=0}function t(){return u||[]}function n(e,t){"undefined"!=typeof i()&&("object"==typeof e?u[c]=e:u[c][e]=t)}function i(){return u[c]}function r(){c=0}function a(){return c+=1}function o(){return("object"==typeof u||"array"==typeof u)&&u.length>=c+1}function s(){console.log("Cleared items"),u=[],c=0}var u,c;return{reset:r,clearAll:s,setAll:e,getAll:t,getCurrent:i,updateCurrent:n,moveToNext:a,hasNext:o}}(),wingaru.stats=function(){function e(e,t,n){var i=$.Deferred();return wingaru.api.requestWithToken("POST","report/stats/"+e.id,{name:t,content:JSON.stringify(n)}).done(function(e){e.status?i.resolve(e.stats):i.reject(e)}),i.promise()}function t(e){var t=$.Deferred();return wingaru.api.requestWithToken("POST","report/stats/"+e+"/complete").done(function(e){e.status?t.resolve(e.stats):t.reject(e)}),t.promise()}function n(e){if(wingaru.auth.isAuthed())return{score:"98"}}function i(e){if(wingaru.auth.isAuthed())return[{name:"John Doe",score:"98"}]}function r(e,t){if(wingaru.auth.isAuthed())return{score:"98"}}function a(e,t){if(wingaru.auth.isAuthed())return[{score:"98"}]}return{load:e,complete:t,getHighScore:n,getLeaderBoard:i,getMyHighScore:r,getMyPreviousScores:a}}();